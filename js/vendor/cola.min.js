!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).cola={})}(this,(function(t){"use strict";function n(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}function e(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function i(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function r(t){var n=0;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,n){if(t){if("string"==typeof t)return i(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?i(t,void 0):void 0}}(t)))return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}var s=function(t,n,e){this.source=t,this.target=n,this.type=e},o=function(){function t(t,n,e,i){var r=this;if(this.linkAccessor=e,this.modules=new Array(t),this.roots=[],i)this.initModulesFromGroup(i);else{this.roots.push(new h);for(var s=0;s<t;++s)this.roots[0].add(this.modules[s]=new u(s))}this.R=n.length,n.forEach((function(t){var n=r.modules[e.getSourceIndex(t)],i=r.modules[e.getTargetIndex(t)],s=e.getType(t);n.outgoing.add(s,i),i.incoming.add(s,n)}))}var n=t.prototype;return n.initModulesFromGroup=function(t){var n=new h;this.roots.push(n);for(var e=0;e<t.leaves.length;++e){var i=t.leaves[e],r=new u(i.id);this.modules[i.id]=r,n.add(r)}if(t.groups)for(var s=0;s<t.groups.length;++s){var o=t.groups[s],c={};for(var f in o)"leaves"!==f&&"groups"!==f&&o.hasOwnProperty(f)&&(c[f]=o[f]);n.add(new u(-1-s,new a,new a,this.initModulesFromGroup(o),c))}return n},n.merge=function(t,n,e){void 0===e&&(e=0);var i=t.incoming.intersection(n.incoming),r=t.outgoing.intersection(n.outgoing),s=new h;s.add(t),s.add(n);var o=new u(this.modules.length,r,i,s);this.modules.push(o);var a=function(e,i,r){e.forAll((function(e,s){e.forAll((function(e){var u=e[i];u.add(s,o),u.remove(s,t),u.remove(s,n),t[r].remove(s,e),n[r].remove(s,e)}))}))};return a(r,"incoming","outgoing"),a(i,"outgoing","incoming"),this.R-=i.count()+r.count(),this.roots[e].remove(t),this.roots[e].remove(n),this.roots[e].add(o),o},n.rootMerges=function(t){void 0===t&&(t=0);for(var n=this.roots[t].modules(),e=n.length,i=new Array(e*(e-1)),r=0,s=0,o=e-1;s<o;++s)for(var u=s+1;u<e;++u){var h=n[s],a=n[u];i[r]={id:r,nEdges:this.nEdges(h,a),a:h,b:a},r++}return i},n.greedyMerge=function(){for(var t=0;t<this.roots.length;++t)if(!(this.roots[t].modules().length<2)){var n=this.rootMerges(t).sort((function(t,n){return t.nEdges==n.nEdges?t.id-n.id:t.nEdges-n.nEdges}))[0];if(!(n.nEdges>=this.R))return this.merge(n.a,n.b,t),!0}},n.nEdges=function(t,n){var e=t.incoming.intersection(n.incoming),i=t.outgoing.intersection(n.outgoing);return this.R-e.count()-i.count()},n.getGroupHierarchy=function(t){var n=this,e=[];return function t(n,e,i){n.forAll((function(n){if(n.isLeaf())e.leaves||(e.leaves=[]),e.leaves.push(n.id);else{var r=e;if(n.gid=i.length,!n.isIsland()||n.isPredefined()){if(r={id:n.gid},n.isPredefined())for(var s in n.definition)r[s]=n.definition[s];e.groups||(e.groups=[]),e.groups.push(n.gid),i.push(r)}t(n.children,r,i)}}))}(this.roots[0],{},e),this.allEdges().forEach((function(i){var r=n.modules[i.source],o=n.modules[i.target];t.push(new s(void 0===r.gid?i.source:e[r.gid],void 0===o.gid?i.target:e[o.gid],i.type))})),e},n.allEdges=function(){var n=[];return t.getEdges(this.roots[0],n),n},t.getEdges=function(n,e){n.forAll((function(n){n.getEdges(e),t.getEdges(n.children,e)}))},t}(),u=function(){function t(t,n,e,i,r){void 0===n&&(n=new a),void 0===e&&(e=new a),void 0===i&&(i=new h),this.id=t,this.outgoing=n,this.incoming=e,this.children=i,this.definition=r}var n=t.prototype;return n.getEdges=function(t){var n=this;this.outgoing.forAll((function(e,i){e.forAll((function(e){t.push(new s(n.id,e.id,i))}))}))},n.isLeaf=function(){return 0===this.children.count()},n.isIsland=function(){return 0===this.outgoing.count()&&0===this.incoming.count()},n.isPredefined=function(){return void 0!==this.definition},t}(),h=function(){function t(){this.table={}}var n=t.prototype;return n.count=function(){return Object.keys(this.table).length},n.intersection=function(n){var e=new t;return e.table=function(t,n){var e={};for(var i in t)i in n&&(e[i]=t[i]);return e}(this.table,n.table),e},n.intersectionCount=function(t){return this.intersection(t).count()},n.contains=function(t){return t in this.table},n.add=function(t){this.table[t.id]=t},n.remove=function(t){delete this.table[t.id]},n.forAll=function(t){for(var n in this.table)t(this.table[n])},n.modules=function(){var t=[];return this.forAll((function(n){n.isPredefined()||t.push(n)})),t},t}(),a=function(){function t(){this.sets={},this.n=0}var n=t.prototype;return n.count=function(){return this.n},n.contains=function(t){var n=!1;return this.forAllModules((function(e){n||e.id!=t||(n=!0)})),n},n.add=function(t,n){(t in this.sets?this.sets[t]:this.sets[t]=new h).add(n),++this.n},n.remove=function(t,n){var e=this.sets[t];e.remove(n),0===e.count()&&delete this.sets[t],--this.n},n.forAll=function(t){for(var n in this.sets)t(this.sets[n],Number(n))},n.forAllModules=function(t){this.forAll((function(n,e){return n.forAll(t)}))},n.intersection=function(n){var e=new t;return this.forAll((function(t,i){if(i in n.sets){var r=t.intersection(n.sets[i]),s=r.count();s>0&&(e.sets[i]=r,e.n+=s)}})),e},t}();function c(t,n,e,i){for(var r=new o(t.length,n,e,i);r.greedyMerge(););var s=[],u=r.getGroupHierarchy(s);return s.forEach((function(n){var e=function(e){var i=n[e];"number"==typeof i&&(n[e]=t[i])};e("source"),e("target")})),{groups:u,powerEdges:s}}function f(t,n){var e={};for(var i in t)e[i]={};for(var i in n)e[i]={};return Object.keys(e).length}function l(t,n){var e=0;for(var i in t)void 0!==n[i]&&++e;return e}function d(t,n,e,i){var r=function(t,n){var e={},i=function(t,n){void 0===e[t]&&(e[t]={}),e[t][n]={}};return t.forEach((function(t){var e=n.getSourceIndex(t),r=n.getTargetIndex(t);i(e,r),i(r,e)})),e}(t,i);t.forEach((function(t){var s=r[i.getSourceIndex(t)],o=r[i.getTargetIndex(t)];i.setLength(t,1+n*e(s,o))}))}function p(t,n,e){void 0===e&&(e=1),d(t,e,(function(t,n){return Math.sqrt(f(t,n)-l(t,n))}),n)}function v(t,n,e){void 0===e&&(e=1),d(t,e,(function(t,n){return Math.min(Object.keys(t).length,Object.keys(n).length)<1.1?0:l(t,n)/f(t,n)}),n)}function g(t,n,e,i){var r=y(t,n,i),s={};r.forEach((function(t,n){return t.forEach((function(t){return s[t]=n}))}));var o=[];return n.forEach((function(t){var n=i.getSourceIndex(t),r=i.getTargetIndex(t);s[n]!==s[r]&&o.push({axis:e,left:n,right:r,gap:i.getMinSeparation(t)})})),o}function y(t,n,e){var i=[],s=0,o=[],u=[];function h(t){t.index=t.lowlink=s++,o.push(t),t.onStack=!0;for(var n,e=r(t.out);!(n=e()).done;){var i=n.value;void 0===i.index?(h(i),t.lowlink=Math.min(t.lowlink,i.lowlink)):i.onStack&&(t.lowlink=Math.min(t.lowlink,i.index))}if(t.lowlink===t.index){for(var a=[];o.length&&((i=o.pop()).onStack=!1,a.push(i),i!==t););u.push(a.map((function(t){return t.id})))}}for(var a=0;a<t;a++)i.push({id:a,out:[]});for(var c,f=r(n);!(c=f()).done;){var l=c.value,d=i[e.getSourceIndex(l)],p=i[e.getTargetIndex(l)];d.out.push(p)}for(var v=0,g=i;v<g.length;v++){var y=g[v];void 0===y.index&&h(y)}return u}var x=function(){function t(){this.locks={}}var n=t.prototype;return n.add=function(t,n){this.locks[t]=n},n.clear=function(){this.locks={}},n.isEmpty=function(){for(var t in this.locks)return!1;return!0},n.apply=function(t){for(var n in this.locks)t(Number(n),this.locks[n])},t}(),m=function(){var t=function(){function t(t,n,e){void 0===e&&(e=null),this.D=n,this.G=e,this.threshold=1e-4,this.numGridSnapNodes=0,this.snapGridSize=100,this.snapStrength=1e3,this.scaleSnapByMaxH=!1,this.random=new _,this.project=null,this.x=t,this.k=t.length;var i=this.n=t[0].length;this.H=new Array(this.k),this.g=new Array(this.k),this.Hd=new Array(this.k),this.a=new Array(this.k),this.b=new Array(this.k),this.c=new Array(this.k),this.d=new Array(this.k),this.e=new Array(this.k),this.ia=new Array(this.k),this.ib=new Array(this.k),this.xtmp=new Array(this.k),this.locks=new x,this.minD=Number.MAX_VALUE;for(var r,s=i;s--;)for(r=i;--r>s;){var o=n[s][r];o>0&&o<this.minD&&(this.minD=o)}for(this.minD===Number.MAX_VALUE&&(this.minD=1),s=this.k;s--;){for(this.g[s]=new Array(i),this.H[s]=new Array(i),r=i;r--;)this.H[s][r]=new Array(i);this.Hd[s]=new Array(i),this.a[s]=new Array(i),this.b[s]=new Array(i),this.c[s]=new Array(i),this.d[s]=new Array(i),this.e[s]=new Array(i),this.ia[s]=new Array(i),this.ib[s]=new Array(i),this.xtmp[s]=new Array(i)}}t.createSquareMatrix=function(t,n){for(var e=new Array(t),i=0;i<t;++i){e[i]=new Array(t);for(var r=0;r<t;++r)e[i][r]=n(i,r)}return e};var n=t.prototype;return n.offsetDir=function(){for(var t=this,n=new Array(this.k),e=0,i=0;i<this.k;++i){var r=n[i]=this.random.getNextBetween(.01,1)-.5;e+=r*r}return e=Math.sqrt(e),n.map((function(n){return n*(t.minD/e)}))},n.computeDerivatives=function(t){var n=this,e=this.n;if(!(e<1)){for(var i,r=new Array(this.k),s=new Array(this.k),o=new Array(this.k),u=0,h=0;h<e;++h){for(i=0;i<this.k;++i)o[i]=this.g[i][h]=0;for(var a=0;a<e;++a)if(h!==a){for(var c=e,f=0;c--;){for(f=0,i=0;i<this.k;++i){var l=r[i]=t[i][h]-t[i][a];f+=s[i]=l*l}if(f>1e-9)break;var d=this.offsetDir();for(i=0;i<this.k;++i)t[i][a]+=d[i]}var p=Math.sqrt(f),v=this.D[h][a],g=null!=this.G?this.G[h][a]:1;if(g>1&&p>v||!isFinite(v))for(i=0;i<this.k;++i)this.H[i][h][a]=0;else{g>1&&(g=1);var y=v*v,x=2*g*(p-v)/(y*p),m=f*p,_=2*-g/(y*m);for(isFinite(x)||console.log(x),i=0;i<this.k;++i)this.g[i][h]+=r[i]*x,o[i]-=this.H[i][h][a]=_*(2*m+v*(s[i]-f))}}for(i=0;i<this.k;++i)u=Math.max(u,this.H[i][h][h]=o[i])}for(var b=this.snapGridSize/2,w=this.snapGridSize,k=this.snapStrength/(b*b),E=this.numGridSnapNodes,A=0;A<E;++A)for(i=0;i<this.k;++i){var M=this.x[i][A],S=M/w,P=S%1,L=S-P,N=Math.abs(P)<=.5?M-L*w:M>0?M-(L+1)*w:M-(L-1)*w;-b<N&&N<=b&&(this.scaleSnapByMaxH?(this.g[i][A]+=u*k*N,this.H[i][A][A]+=u*k):(this.g[i][A]+=k*N,this.H[i][A][A]+=k))}this.locks.isEmpty()||this.locks.apply((function(e,r){for(i=0;i<n.k;++i)n.H[i][e][e]+=u,n.g[i][e]-=u*(r[i]-t[i][e])}))}},t.dotProd=function(t,n){for(var e=0,i=t.length;i--;)e+=t[i]*n[i];return e},t.rightMultiply=function(n,e,i){for(var r=n.length;r--;)i[r]=t.dotProd(n[r],e)},n.computeStepSize=function(n){for(var e=0,i=0,r=0;r<this.k;++r)e+=t.dotProd(this.g[r],n[r]),t.rightMultiply(this.H[r],n[r],this.Hd[r]),i+=t.dotProd(n[r],this.Hd[r]);return 0!==i&&isFinite(i)?1*e/i:0},n.reduceStress=function(){this.computeDerivatives(this.x);for(var t=this.computeStepSize(this.g),n=0;n<this.k;++n)this.takeDescentStep(this.x[n],this.g[n],t);return this.computeStress()},t.copy=function(t,n){for(var e=t.length,i=n[0].length,r=0;r<e;++r)for(var s=0;s<i;++s)n[r][s]=t[r][s]},n.stepAndProject=function(n,e,i,r){t.copy(n,e),this.takeDescentStep(e[0],i[0],r),this.project&&this.project[0](n[0],n[1],e[0]),this.takeDescentStep(e[1],i[1],r),this.project&&this.project[1](e[0],n[1],e[1]);for(var s=2;s<this.k;s++)this.takeDescentStep(e[s],i[s],r)},t.mApply=function(t,n,e){for(var i=t;i-- >0;)for(var r=n;r-- >0;)e(i,r)},n.matrixApply=function(n){t.mApply(this.k,this.n,n)},n.computeNextPosition=function(t,n){var e=this;this.computeDerivatives(t);var i=this.computeStepSize(this.g);if(this.stepAndProject(t,n,this.g,i),this.project){this.matrixApply((function(i,r){return e.e[i][r]=t[i][r]-n[i][r]}));var r=this.computeStepSize(this.e);r=Math.max(.2,Math.min(r,1)),this.stepAndProject(t,n,this.e,r)}},n.run=function(t){for(var n=Number.MAX_VALUE,e=!1;!e&&t-- >0;){var i=this.rungeKutta();e=Math.abs(n/i-1)<this.threshold,n=i}return n},n.rungeKutta=function(){var n=this;this.computeNextPosition(this.x,this.a),t.mid(this.x,this.a,this.ia),this.computeNextPosition(this.ia,this.b),t.mid(this.x,this.b,this.ib),this.computeNextPosition(this.ib,this.c),this.computeNextPosition(this.c,this.d);var e=0;return this.matrixApply((function(t,i){var r=(n.a[t][i]+2*n.b[t][i]+2*n.c[t][i]+n.d[t][i])/6,s=n.x[t][i]-r;e+=s*s,n.x[t][i]=r})),e},t.mid=function(n,e,i){t.mApply(n.length,n[0].length,(function(t,r){return i[t][r]=n[t][r]+(e[t][r]-n[t][r])/2}))},n.takeDescentStep=function(t,n,e){for(var i=0;i<this.n;++i)t[i]=t[i]-e*n[i]},n.computeStress=function(){for(var t=0,n=0,e=this.n-1;n<e;++n)for(var i=n+1,r=this.n;i<r;++i){for(var s=0,o=0;o<this.k;++o){var u=this.x[o][n]-this.x[o][i];s+=u*u}s=Math.sqrt(s);var h=this.D[n][i];if(isFinite(h)){var a=h-s;t+=a*a/(h*h)}}return t},t}();return t.zeroDistance=1e-10,t}(),_=function(){function t(t){void 0===t&&(t=1),this.seed=t,this.a=214013,this.c=2531011,this.m=2147483648,this.range=32767}var n=t.prototype;return n.getNext=function(){return this.seed=(this.seed*this.a+this.c)%this.m,(this.seed>>16)/this.range},n.getNextBetween=function(t,n){return t+this.getNext()*(n-t)},t}(),b=function(){function t(t){this.scale=t,this.AB=0,this.AD=0,this.A2=0}var n=t.prototype;return n.addVariable=function(t){var n=this.scale/t.scale,e=t.weight;this.AB+=e*n*(t.offset/t.scale),this.AD+=e*n*t.desiredPosition,this.A2+=e*n*n},n.getPosn=function(){return(this.AD-this.AB)/this.A2},t}(),w=function(){function t(t,n,e,i){void 0===i&&(i=!1),this.left=t,this.right=n,this.gap=e,this.equality=i,this.active=!1,this.unsatisfiable=!1,this.left=t,this.right=n,this.gap=e,this.equality=i}return t.prototype.slack=function(){return this.unsatisfiable?Number.MAX_VALUE:this.right.scale*this.right.position()-this.gap-this.left.scale*this.left.position()},t}(),k=function(){function t(t,n,e){void 0===n&&(n=1),void 0===e&&(e=1),this.desiredPosition=t,this.weight=n,this.scale=e,this.offset=0}var n=t.prototype;return n.dfdv=function(){return 2*this.weight*(this.position()-this.desiredPosition)},n.position=function(){return(this.block.ps.scale*this.block.posn+this.offset)/this.scale},n.visitNeighbours=function(t,n){var e=function(e,i){return e.active&&t!==i&&n(e,i)};this.cOut.forEach((function(t){return e(t,t.right)})),this.cIn.forEach((function(t){return e(t,t.left)}))},t}(),E=function(){function t(t){this.vars=[],t.offset=0,this.ps=new b(t.scale),this.addVariable(t)}var n=t.prototype;return n.addVariable=function(t){t.block=this,this.vars.push(t),this.ps.addVariable(t),this.posn=this.ps.getPosn()},n.updateWeightedPosition=function(){this.ps.AB=this.ps.AD=this.ps.A2=0;for(var t=0,n=this.vars.length;t<n;++t)this.ps.addVariable(this.vars[t]);this.posn=this.ps.getPosn()},n.compute_lm=function(t,n,e){var i=this,r=t.dfdv();return t.visitNeighbours(n,(function(n,s){var o=i.compute_lm(s,t,e);s===n.right?(r+=o*n.left.scale,n.lm=o):(r+=o*n.right.scale,n.lm=-o),e(n)})),r/t.scale},n.populateSplitBlock=function(t,n){var e=this;t.visitNeighbours(n,(function(n,i){i.offset=t.offset+(i===n.right?n.gap:-n.gap),e.addVariable(i),e.populateSplitBlock(i,t)}))},n.traverse=function(t,n,e,i){var r=this;void 0===e&&(e=this.vars[0]),void 0===i&&(i=null),e.visitNeighbours(i,(function(i,s){n.push(t(i)),r.traverse(t,n,s,e)}))},n.findMinLM=function(){var t=null;return this.compute_lm(this.vars[0],null,(function(n){!n.equality&&(null===t||n.lm<t.lm)&&(t=n)})),t},n.findMinLMBetween=function(t,n){this.compute_lm(t,null,(function(){}));var e=null;return this.findPath(t,null,n,(function(t,n){!t.equality&&t.right===n&&(null===e||t.lm<e.lm)&&(e=t)})),e},n.findPath=function(t,n,e,i){var r=this,s=!1;return t.visitNeighbours(n,(function(n,o){s||o!==e&&!r.findPath(o,t,e,i)||(s=!0,i(n,o))})),s},n.isActiveDirectedPathBetween=function(t,n){if(t===n)return!0;for(var e=t.cOut.length;e--;){var i=t.cOut[e];if(i.active&&this.isActiveDirectedPathBetween(i.right,n))return!0}return!1},t.split=function(n){return n.active=!1,[t.createSplitBlock(n.left),t.createSplitBlock(n.right)]},t.createSplitBlock=function(n){var e=new t(n);return e.populateSplitBlock(n,null),e},n.splitBetween=function(n,e){var i=this.findMinLMBetween(n,e);if(null!==i){var r=t.split(i);return{constraint:i,lb:r[0],rb:r[1]}}return null},n.mergeAcross=function(t,n,e){n.active=!0;for(var i=0,r=t.vars.length;i<r;++i){var s=t.vars[i];s.offset+=e,this.addVariable(s)}this.posn=this.ps.getPosn()},n.cost=function(){for(var t=0,n=this.vars.length;n--;){var e=this.vars[n],i=e.position()-e.desiredPosition;t+=i*i*e.weight}return t},t}(),A=function(){function t(t){this.vs=t;var n=t.length;for(this.list=new Array(n);n--;){var e=new E(t[n]);this.list[n]=e,e.blockInd=n}}var n=t.prototype;return n.cost=function(){for(var t=0,n=this.list.length;n--;)t+=this.list[n].cost();return t},n.insert=function(t){t.blockInd=this.list.length,this.list.push(t)},n.remove=function(t){var n=this.list.length-1,e=this.list[n];this.list.length=n,t!==e&&(this.list[t.blockInd]=e,e.blockInd=t.blockInd)},n.merge=function(t){var n=t.left.block,e=t.right.block,i=t.right.offset-t.left.offset-t.gap;n.vars.length<e.vars.length?(e.mergeAcross(n,t,i),this.remove(n)):(n.mergeAcross(e,t,-i),this.remove(e))},n.forEach=function(t){this.list.forEach(t)},n.updateBlockPositions=function(){this.list.forEach((function(t){return t.updateWeightedPosition()}))},n.split=function(t){var n=this;this.updateBlockPositions(),this.list.forEach((function(e){var i=e.findMinLM();null!==i&&i.lm<M.LAGRANGIAN_TOLERANCE&&(e=i.left.block,E.split(i).forEach((function(t){return n.insert(t)})),n.remove(e),t.push(i))}))},t}(),M=function(){var t=function(){function t(t,n){this.vs=t,this.cs=n,this.vs=t,t.forEach((function(t){t.cIn=[],t.cOut=[]})),this.cs=n,n.forEach((function(t){t.left.cOut.push(t),t.right.cIn.push(t)})),this.inactive=n.map((function(t){return t.active=!1,t})),this.bs=null}var n=t.prototype;return n.cost=function(){return this.bs.cost()},n.setStartingPositions=function(t){this.inactive=this.cs.map((function(t){return t.active=!1,t})),this.bs=new A(this.vs),this.bs.forEach((function(n,e){return n.posn=t[e]}))},n.setDesiredPositions=function(t){this.vs.forEach((function(n,e){return n.desiredPosition=t[e]}))},n.mostViolated=function(){for(var n=Number.MAX_VALUE,e=null,i=this.inactive,r=i.length,s=r,o=0;o<r;++o){var u=i[o];if(!u.unsatisfiable){var h=u.slack();if((u.equality||h<n)&&(n=h,e=u,s=o,u.equality))break}}return s!==r&&(n<t.ZERO_UPPERBOUND&&!e.active||e.equality)&&(i[s]=i[r-1],i.length=r-1),e},n.satisfy=function(){null==this.bs&&(this.bs=new A(this.vs)),this.bs.split(this.inactive);for(var n=null;(n=this.mostViolated())&&(n.equality||n.slack()<t.ZERO_UPPERBOUND&&!n.active);){var e=n.left.block;if(e!==n.right.block)this.bs.merge(n);else{if(e.isActiveDirectedPathBetween(n.right,n.left)){n.unsatisfiable=!0;continue}var i=e.splitBetween(n.left,n.right);if(null===i){n.unsatisfiable=!0;continue}this.bs.insert(i.lb),this.bs.insert(i.rb),this.bs.remove(e),this.inactive.push(i.constraint),n.slack()>=0?this.inactive.push(n):this.bs.merge(n)}}},n.solve=function(){this.satisfy();for(var t=Number.MAX_VALUE,n=this.bs.cost();Math.abs(t-n)>1e-4;)this.satisfy(),t=n,n=this.bs.cost();return n},t}();return t.LAGRANGIAN_TOLERANCE=-1e-4,t.ZERO_UPPERBOUND=-1e-10,t}(),S=function(){function t(){this.findIter=function(t){for(var n=this._root,e=this.iterator();null!==n;){var i=this._comparator(t,n.data);if(0===i)return e._cursor=n,e;e._ancestors.push(n),n=n.get_child(i>0)}return null}}var n=t.prototype;return n.clear=function(){this._root=null,this.size=0},n.find=function(t){for(var n=this._root;null!==n;){var e=this._comparator(t,n.data);if(0===e)return n.data;n=n.get_child(e>0)}return null},n.lowerBound=function(t){return this._bound(t,this._comparator)},n.upperBound=function(t){var n=this._comparator;return this._bound(t,(function(t,e){return n(e,t)}))},n.min=function(){var t=this._root;if(null===t)return null;for(;null!==t.left;)t=t.left;return t.data},n.max=function(){var t=this._root;if(null===t)return null;for(;null!==t.right;)t=t.right;return t.data},n.iterator=function(){return new P(this)},n.each=function(t){for(var n,e=this.iterator();null!==(n=e.next());)t(n)},n.reach=function(t){for(var n,e=this.iterator();null!==(n=e.prev());)t(n)},n._bound=function(t,n){for(var e=this._root,i=this.iterator();null!==e;){var r=this._comparator(t,e.data);if(0===r)return i._cursor=e,i;i._ancestors.push(e),e=e.get_child(r>0)}for(var s=i._ancestors.length-1;s>=0;--s)if(n(t,(e=i._ancestors[s]).data)>0)return i._cursor=e,i._ancestors.length=s,i;return i._ancestors.length=0,i},t}(),P=function(){function t(t){this._tree=t,this._ancestors=[],this._cursor=null}var n=t.prototype;return n.data=function(){return null!==this._cursor?this._cursor.data:null},n.next=function(){if(null===this._cursor){var t=this._tree._root;null!==t&&this._minNode(t)}else{var n;if(null===this._cursor.right)do{if(n=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===n);else this._ancestors.push(this._cursor),this._minNode(this._cursor.right)}return null!==this._cursor?this._cursor.data:null},n.prev=function(){if(null===this._cursor){var t=this._tree._root;null!==t&&this._maxNode(t)}else{var n;if(null===this._cursor.left)do{if(n=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===n);else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left)}return null!==this._cursor?this._cursor.data:null},n._minNode=function(t){for(;null!==t.left;)this._ancestors.push(t),t=t.left;this._cursor=t},n._maxNode=function(t){for(;null!==t.right;)this._ancestors.push(t),t=t.right;this._cursor=t},t}(),L=function(){function t(t){this.data=t,this.left=null,this.right=null,this.red=!0}var n=t.prototype;return n.get_child=function(t){return t?this.right:this.left},n.set_child=function(t,n){t?this.right=n:this.left=n},t}(),N=function(t){function e(n){var e;return(e=t.call(this)||this)._root=null,e._comparator=n,e.size=0,e}n(e,t);var i=e.prototype;return i.insert=function(t){var n=!1;if(null===this._root)this._root=new L(t),n=!0,this.size++;else{var i=new L(void 0),r=!1,s=!1,o=null,u=i,h=null,a=this._root;for(u.right=this._root;;){if(null===a?(a=new L(t),h.set_child(r,a),n=!0,this.size++):e.is_red(a.left)&&e.is_red(a.right)&&(a.red=!0,a.left.red=!1,a.right.red=!1),e.is_red(a)&&e.is_red(h)){var c=u.right===o;a===h.get_child(s)?u.set_child(c,e.single_rotate(o,!s)):u.set_child(c,e.double_rotate(o,!s))}var f=this._comparator(a.data,t);if(0===f)break;s=r,null!==o&&(u=o),o=h,h=a,a=a.get_child(r=f<0)}this._root=i.right}return this._root.red=!1,n},i.remove=function(t){if(null===this._root)return!1;var n=new L(void 0),i=n;i.right=this._root;for(var r=null,s=null,o=null,u=!0;null!==i.get_child(u);){var h=u;s=r,r=i,i=i.get_child(u);var a=this._comparator(t,i.data);if(u=a>0,0===a&&(o=i),!e.is_red(i)&&!e.is_red(i.get_child(u)))if(e.is_red(i.get_child(!u))){var c=e.single_rotate(i,u);r.set_child(h,c),r=c}else if(!e.is_red(i.get_child(!u))){var f=r.get_child(!h);if(null!==f)if(e.is_red(f.get_child(!h))||e.is_red(f.get_child(h))){var l=s.right===r;e.is_red(f.get_child(h))?s.set_child(l,e.double_rotate(r,h)):e.is_red(f.get_child(!h))&&s.set_child(l,e.single_rotate(r,h));var d=s.get_child(l);d.red=!0,i.red=!0,d.left.red=!1,d.right.red=!1}else r.red=!1,f.red=!0,i.red=!0}}return null!==o&&(o.data=i.data,r.set_child(r.right===i,i.get_child(null===i.left)),this.size--),this._root=n.right,null!==this._root&&(this._root.red=!1),null!==o},e.is_red=function(t){return null!==t&&t.red},e.single_rotate=function(t,n){var e=t.get_child(!n);return t.set_child(!n,e.get_child(n)),e.set_child(n,t),t.red=!0,e.red=!1,e},e.double_rotate=function(t,n){return t.set_child(!n,e.single_rotate(t.get_child(!n),!n)),e.single_rotate(t,n)},e}(S);function I(t){return t.bounds=void 0!==t.leaves?t.leaves.reduce((function(t,n){return n.bounds.union(t)}),T.empty()):T.empty(),void 0!==t.groups&&(t.bounds=t.groups.reduce((function(t,n){return I(n).union(t)}),t.bounds)),t.bounds=t.bounds.inflate(t.padding),t.bounds}var T=function(){function t(t,n,e,i){this.x=t,this.X=n,this.y=e,this.Y=i}t.empty=function(){return new t(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY)};var n=t.prototype;return n.cx=function(){return(this.x+this.X)/2},n.cy=function(){return(this.y+this.Y)/2},n.overlapX=function(t){var n=this.cx(),e=t.cx();return n<=e&&t.x<this.X?this.X-t.x:e<=n&&this.x<t.X?t.X-this.x:0},n.overlapY=function(t){var n=this.cy(),e=t.cy();return n<=e&&t.y<this.Y?this.Y-t.y:e<=n&&this.y<t.Y?t.Y-this.y:0},n.setXCentre=function(t){var n=t-this.cx();this.x+=n,this.X+=n},n.setYCentre=function(t){var n=t-this.cy();this.y+=n,this.Y+=n},n.width=function(){return this.X-this.x},n.height=function(){return this.Y-this.y},n.union=function(n){return new t(Math.min(this.x,n.x),Math.max(this.X,n.X),Math.min(this.y,n.y),Math.max(this.Y,n.Y))},n.lineIntersections=function(n,e,i,r){for(var s=[[this.x,this.y,this.X,this.y],[this.X,this.y,this.X,this.Y],[this.X,this.Y,this.x,this.Y],[this.x,this.Y,this.x,this.y]],o=[],u=0;u<4;++u){var h=t.lineIntersection(n,e,i,r,s[u][0],s[u][1],s[u][2],s[u][3]);null!==h&&o.push({x:h.x,y:h.y})}return o},n.rayIntersection=function(t,n){var e=this.lineIntersections(this.cx(),this.cy(),t,n);return e.length>0?e[0]:null},n.vertices=function(){return[{x:this.x,y:this.y},{x:this.X,y:this.y},{x:this.X,y:this.Y},{x:this.x,y:this.Y}]},t.lineIntersection=function(t,n,e,i,r,s,o,u){var h=e-t,a=o-r,c=i-n,f=u-s,l=f*h-a*c;if(0==l)return null;var d=t-r,p=n-s,v=(a*p-f*d)/l,g=(h*p-c*d)/l;return v>=0&&v<=1&&g>=0&&g<=1?{x:t+v*h,y:n+v*c}:null},n.inflate=function(n){return new t(this.x-n,this.X+n,this.y-n,this.Y+n)},t}();function C(t,n,e){var i=t.rayIntersection(n.cx(),n.cy())||{x:t.cx(),y:t.cy()},r=n.rayIntersection(t.cx(),t.cy())||{x:n.cx(),y:n.cy()},s=r.x-i.x,o=r.y-i.y,u=Math.sqrt(s*s+o*o),h=u-e;return{sourceIntersection:i,targetIntersection:r,arrowStart:{x:i.x+h*s/u,y:i.y+h*o/u}}}function O(t,n,e){var i=n.rayIntersection(t.x,t.y);i||(i={x:n.cx(),y:n.cy()});var r=i.x-t.x,s=i.y-t.y,o=Math.sqrt(r*r+s*s);return{x:i.x-e*r/o,y:i.y-e*s/o}}var V=function(t,n,e){this.v=t,this.r=n,this.pos=e,this.prev=B(),this.next=B()},G=function(t,n,e){this.isOpen=t,this.v=n,this.pos=e};function D(t,n){return t.pos>n.pos?1:t.pos<n.pos||t.isOpen?-1:n.isOpen?1:0}function B(){return new N((function(t,n){return t.pos-n.pos}))}var z={getCentre:function(t){return t.cx()},getOpen:function(t){return t.y},getClose:function(t){return t.Y},getSize:function(t){return t.width()},makeRect:function(t,n,e,i){return new T(e-i/2,e+i/2,t,n)},findNeighbours:function(t,n){var e=function(e,i){for(var r,s=n.findIter(t);null!==(r=s[e]());){var o=r.r.overlapX(t.r);if((o<=0||o<=r.r.overlapY(t.r))&&(t[e].insert(r),r[i].insert(t)),o<=0)break}};e("next","prev"),e("prev","next")}},X={getCentre:function(t){return t.cy()},getOpen:function(t){return t.x},getClose:function(t){return t.X},getSize:function(t){return t.height()},makeRect:function(t,n,e,i){return new T(t,n,e-i/2,e+i/2)},findNeighbours:function(t,n){var e=function(e,i){var r=n.findIter(t)[e]();null!==r&&r.r.overlapX(t.r)>0&&(t[e].insert(r),r[i].insert(t))};e("next","prev"),e("prev","next")}};function j(t,n,e,i){void 0===i&&(i=!1);var r=t.padding,s=void 0!==t.groups?t.groups.length:0,o=void 0!==t.leaves?t.leaves.length:0,u=s?t.groups.reduce((function(t,i){return t.concat(j(i,n,e,!0))}),[]):[],h=(i?2:0)+o+s,a=new Array(h),c=new Array(h),f=0,l=function(t,n){c[f]=t,a[f++]=n};if(i){var d=t.bounds,p=n.getCentre(d),v=n.getSize(d)/2,g=n.getOpen(d),y=n.getClose(d),x=p-v+r/2,m=p+v-r/2;t.minVar.desiredPosition=x,l(n.makeRect(g,y,x,r),t.minVar),t.maxVar.desiredPosition=m,l(n.makeRect(g,y,m,r),t.maxVar)}o&&t.leaves.forEach((function(t){return l(t.bounds,t.variable)})),s&&t.groups.forEach((function(t){var e=t.bounds;l(n.makeRect(n.getOpen(e),n.getClose(e),n.getCentre(e),n.getSize(e)),t.minVar)}));var _=Y(c,a,n,e);return s&&(a.forEach((function(t){t.cOut=[],t.cIn=[]})),_.forEach((function(t){t.left.cOut.push(t),t.right.cIn.push(t)})),t.groups.forEach((function(t){var e=(t.padding-n.getSize(t.bounds))/2;t.minVar.cIn.forEach((function(t){return t.gap+=e})),t.minVar.cOut.forEach((function(n){n.left=t.maxVar,n.gap+=e}))}))),u.concat(_)}function Y(t,n,e,i){var r,s=t.length,o=2*s;console.assert(n.length>=s);var u=new Array(o);for(r=0;r<s;++r){var h=t[r],a=new V(n[r],h,e.getCentre(h));u[r]=new G(!0,a,e.getOpen(h)),u[r+s]=new G(!1,a,e.getClose(h))}u.sort(D);var c=new Array,f=B();for(r=0;r<o;++r){var l=u[r];if(a=l.v,l.isOpen)f.insert(a),e.findNeighbours(a,f);else{f.remove(a);var d=function(t,n){var r=(e.getSize(t.r)+e.getSize(n.r))/2+i;c.push(new w(t.v,n.v,r))},p=function(t,n,e){for(var i,r=a[t].iterator();null!==(i=r[t]());)e(i,a),i[n].remove(a)};p("prev","next",(function(t,n){return d(t,n)})),p("next","prev",(function(t,n){return d(n,t)}))}}return console.assert(0===f.size),c}function R(t,n){return Y(t,n,z,1e-6)}function q(t,n){return Y(t,n,X,1e-6)}function F(t){return j(t,z,1e-6)}function H(t){return j(t,X,1e-6)}var U=function(t){function e(n,e){var i;return(i=t.call(this,0,e)||this).index=n,i}return n(e,t),e}(k),K=function(){function t(t,n,e,i,r){var s=this;if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=!1),this.nodes=t,this.groups=n,this.rootGroup=e,this.avoidOverlaps=r,this.variables=t.map((function(t,n){return t.variable=new U(n,1)})),i&&this.createConstraints(i),r&&e&&void 0!==e.groups){t.forEach((function(t){if(t.width&&t.height){var n=t.width/2,e=t.height/2;t.bounds=new T(t.x-n,t.x+n,t.y-e,t.y+e)}else t.bounds=new T(t.x,t.x,t.y,t.y)})),I(e);var o=t.length;n.forEach((function(t){s.variables[o]=t.minVar=new U(o++,void 0!==t.stiffness?t.stiffness:.01),s.variables[o]=t.maxVar=new U(o++,void 0!==t.stiffness?t.stiffness:.01)}))}}var n=t.prototype;return n.createSeparation=function(t){return new w(this.nodes[t.left].variable,this.nodes[t.right].variable,t.gap,void 0!==t.equality&&t.equality)},n.makeFeasible=function(t){var n=this;if(this.avoidOverlaps){var e="x",i="width";"x"===t.axis&&(e="y",i="height");var r=t.offsets.map((function(t){return n.nodes[t.node]})).sort((function(t,n){return t[e]-n[e]})),s=null;r.forEach((function(t){if(s){var n=s[e]+s[i];n>t[e]&&(t[e]=n)}s=t}))}},n.createAlignment=function(t){var n=this,e=this.nodes[t.offsets[0].node].variable;this.makeFeasible(t);var i="x"===t.axis?this.xConstraints:this.yConstraints;t.offsets.slice(1).forEach((function(t){i.push(new w(e,n.nodes[t.node].variable,t.offset,!0))}))},n.createConstraints=function(t){var n=this,e=function(t){return void 0===t.type||"separation"===t.type};this.xConstraints=t.filter((function(t){return"x"===t.axis&&e(t)})).map((function(t){return n.createSeparation(t)})),this.yConstraints=t.filter((function(t){return"y"===t.axis&&e(t)})).map((function(t){return n.createSeparation(t)})),t.filter((function(t){return"alignment"===t.type})).forEach((function(t){return n.createAlignment(t)}))},n.setupVariablesAndBounds=function(t,n,e,i){this.nodes.forEach((function(r,s){r.fixed?(r.variable.weight=r.fixedWeight?r.fixedWeight:1e3,e[s]=i(r)):r.variable.weight=1;var o=(r.width||0)/2,u=(r.height||0)/2,h=t[s],a=n[s];r.bounds=new T(h-o,h+o,a-u,a+u)}))},n.xProject=function(t,n,e){(this.rootGroup||this.avoidOverlaps||this.xConstraints)&&this.project(t,n,t,e,(function(t){return t.px}),this.xConstraints,F,(function(t){return t.bounds.setXCentre(e[t.variable.index]=t.variable.position())}),(function(t){var n=e[t.minVar.index]=t.minVar.position(),i=e[t.maxVar.index]=t.maxVar.position(),r=t.padding/2;t.bounds.x=n-r,t.bounds.X=i+r}))},n.yProject=function(t,n,e){(this.rootGroup||this.yConstraints)&&this.project(t,n,n,e,(function(t){return t.py}),this.yConstraints,H,(function(t){return t.bounds.setYCentre(e[t.variable.index]=t.variable.position())}),(function(t){var n=e[t.minVar.index]=t.minVar.position(),i=e[t.maxVar.index]=t.maxVar.position(),r=t.padding/2;t.bounds.y=n-r,t.bounds.Y=i+r}))},n.projectFunctions=function(){var t=this;return[function(n,e,i){return t.xProject(n,e,i)},function(n,e,i){return t.yProject(n,e,i)}]},n.project=function(t,n,e,i,r,s,o,u,h){this.setupVariablesAndBounds(t,n,i,r),this.rootGroup&&this.avoidOverlaps&&(I(this.rootGroup),s=s.concat(o(this.rootGroup))),this.solve(this.variables,s,e,i),this.nodes.forEach(u),this.rootGroup&&this.avoidOverlaps&&(this.groups.forEach(h),I(this.rootGroup))},n.solve=function(t,n,e,i){var r=new M(t,n);r.setStartingPositions(e),r.setDesiredPositions(i),r.solve()},t}(),W=function(){function t(t){this.elem=t,this.subheaps=[]}var n=t.prototype;return n.toString=function(t){for(var n="",e=!1,i=0;i<this.subheaps.length;++i){var r=this.subheaps[i];r.elem?(e&&(n+=","),n+=r.toString(t),e=!0):e=!1}return""!==n&&(n="("+n+")"),(this.elem?t(this.elem):"")+n},n.forEach=function(t){this.empty()||(t(this.elem,this),this.subheaps.forEach((function(n){return n.forEach(t)})))},n.count=function(){return this.empty()?0:1+this.subheaps.reduce((function(t,n){return t+n.count()}),0)},n.min=function(){return this.elem},n.empty=function(){return null==this.elem},n.contains=function(t){if(this===t)return!0;for(var n=0;n<this.subheaps.length;n++)if(this.subheaps[n].contains(t))return!0;return!1},n.isHeap=function(t){var n=this;return this.subheaps.every((function(e){return t(n.elem,e.elem)&&e.isHeap(t)}))},n.insert=function(n,e){return this.merge(new t(n),e)},n.merge=function(t,n){return this.empty()?t:t.empty()?this:n(this.elem,t.elem)?(this.subheaps.push(t),this):(t.subheaps.push(this),t)},n.removeMin=function(t){return this.empty()?null:this.mergePairs(t)},n.mergePairs=function(n){if(0==this.subheaps.length)return new t(null);if(1==this.subheaps.length)return this.subheaps[0];var e=this.subheaps.pop().merge(this.subheaps.pop(),n),i=this.mergePairs(n);return e.merge(i,n)},n.decreaseKey=function(n,e,i,r){var s=n.removeMin(r);n.elem=s.elem,n.subheaps=s.subheaps,null!==i&&null!==s.elem&&i(n.elem,n);var o=new t(e);return null!==i&&i(e,o),this.merge(o,r)},t}(),Z=function(){function t(t){this.lessThan=t}var n=t.prototype;return n.top=function(){return this.empty()?null:this.root.elem},n.push=function(){for(var t,n,e=0;n=e<0||arguments.length<=e?void 0:arguments[e];++e)t=new W(n),this.root=this.empty()?t:this.root.merge(t,this.lessThan);return t},n.empty=function(){return!this.root||!this.root.elem},n.isHeap=function(){return this.root.isHeap(this.lessThan)},n.forEach=function(t){this.root.forEach(t)},n.pop=function(){if(this.empty())return null;var t=this.root.min();return this.root=this.root.removeMin(this.lessThan),t},n.reduceKey=function(t,n,e){void 0===e&&(e=null),this.root=this.root.decreaseKey(t,n,e,this.lessThan)},n.toString=function(t){return this.root.toString(t)},n.count=function(){return this.root.count()},t}(),J=function(t,n){this.id=t,this.distance=n},Q=function(t){this.id=t,this.neighbours=[]},$=function(t,n,e){this.node=t,this.prev=n,this.d=e},tt=function(){function t(t,n,e,i,r){this.n=t,this.es=n,this.neighbours=new Array(this.n);for(var s=this.n;s--;)this.neighbours[s]=new Q(s);for(s=this.es.length;s--;){var o=this.es[s],u=e(o),h=i(o),a=r(o);this.neighbours[u].neighbours.push(new J(h,a)),this.neighbours[h].neighbours.push(new J(u,a))}}var n=t.prototype;return n.DistanceMatrix=function(){for(var t=new Array(this.n),n=0;n<this.n;++n)t[n]=this.dijkstraNeighbours(n);return t},n.DistancesFromNode=function(t){return this.dijkstraNeighbours(t)},n.PathFromNodeToNode=function(t,n){return this.dijkstraNeighbours(t,n)},n.PathFromNodeToNodeWithPrevCost=function(t,n,e){var i=new Z((function(t,n){return t.d<=n.d})),r=this.neighbours[t],s=new $(r,null,0),o={};for(i.push(s);!i.empty()&&(r=(s=i.pop()).node).id!==n;)for(var u=r.neighbours.length;u--;){var h=r.neighbours[u],a=this.neighbours[h.id];if(!s.prev||a.id!==s.prev.node.id){var c=a.id+","+r.id;if(!(c in o&&o[c]<=s.d)){var f=s.prev?e(s.prev.node.id,r.id,a.id):0,l=s.d+h.distance+f;o[c]=l,i.push(new $(a,s,l))}}}for(var d=[];s.prev;)d.push((s=s.prev).node.id);return d},n.dijkstraNeighbours=function(t,n){void 0===n&&(n=-1);for(var e=new Z((function(t,n){return t.d<=n.d})),i=this.neighbours.length,r=new Array(i);i--;){var s=this.neighbours[i];s.d=i===t?0:Number.POSITIVE_INFINITY,s.q=e.push(s)}for(;!e.empty();){var o=e.pop();if(r[o.id]=o.d,o.id===n){for(var u=[],h=o;void 0!==h.prev;)u.push(h.prev.id),h=h.prev;return u}for(i=o.neighbours.length;i--;){var a=o.neighbours[i],c=(h=this.neighbours[a.id],o.d+a.distance);o.d!==Number.MAX_VALUE&&h.d>c&&(h.d=c,h.prev=o,e.reduceKey(h.q,h,(function(t,n){return t.q=n})))}}return r},t}(),nt=function(){},et=function(t,n,e,i){this.x1=t,this.y1=n,this.x2=e,this.y2=i},it=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e}(nt);function rt(t,n,e){return(n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y)}function st(t,n,e){return rt(t,n,e)>0}function ot(t,n,e){return rt(t,n,e)<0}function ut(t,n){var e,i,r,s,o=n.length-1;if(ot(t,n[1],n[0])&&!st(t,n[o-1],n[0]))return 0;for(e=0,i=o;;){if(i-e==1)return st(t,n[e],n[i])?e:i;if((s=ot(t,n[(r=Math.floor((e+i)/2))+1],n[r]))&&!st(t,n[r-1],n[r]))return r;st(t,n[e+1],n[e])?s||st(t,n[e],n[r])?i=r:e=r:s&&ot(t,n[e],n[r])?i=r:e=r}}function ht(t,n){var e,i,r,s,o=n.length-1;if(st(t,n[o-1],n[0])&&!ot(t,n[1],n[0]))return 0;for(e=0,i=o;;){if(i-e==1)return ot(t,n[e],n[i])?e:i;if(s=ot(t,n[(r=Math.floor((e+i)/2))+1],n[r]),st(t,n[r-1],n[r])&&!s)return r;ot(t,n[e+1],n[e])?s?ot(t,n[e],n[r])?i=r:e=r:i=r:s?e=r:st(t,n[e],n[r])?i=r:e=r}}function at(t,n,e,i,r,s){var o,u;u=i(t[o=e(n[0],t)],n);for(var h=!1;!h;){for(h=!0;o===t.length-1&&(o=0),!r(n[u],t[o],t[o+1]);)++o;for(;0===u&&(u=n.length-1),!s(t[o],n[u],n[u-1]);)--u,h=!1}return{t1:o,t2:u}}function ct(t,n){return at(t,n,ut,ht,st,ot)}var ft=function(t,n){this.t1=t,this.t2=n},lt=function(){},dt=function(t){function e(){return t.apply(this,arguments)||this}return n(e,t),e}(nt),pt=function(t,n,e,i){this.id=t,this.polyid=n,this.polyvertid=e,this.p=i,i.vv=this},vt=function(){function t(t,n){this.source=t,this.target=n}return t.prototype.length=function(){var t=this.source.p.x-this.target.p.x,n=this.source.p.y-this.target.p.y;return Math.sqrt(t*t+n*n)},t}(),gt=function(){function t(t,n){if(this.P=t,this.V=[],this.E=[],n)this.V=n.V.slice(0),this.E=n.E.slice(0);else{for(var e=t.length,i=0;i<e;i++){for(var r=t[i],s=0;s<r.length;++s){var o=new pt(this.V.length,i,s,r[s]);this.V.push(o),s>0&&this.E.push(new vt(r[s-1].vv,o))}r.length>1&&this.E.push(new vt(r[0].vv,r[r.length-1].vv))}for(i=0;i<e-1;i++){var u=t[i];for(s=i+1;s<e;s++){var h=t[s],a=xt(u,h);for(var c in a){var f=a[c];this.addEdgeIfVisible(u[f.t1],h[f.t2],i,s)}}}}}var n=t.prototype;return n.addEdgeIfVisible=function(t,n,e,i){this.intersectsPolys(new et(t.x,t.y,n.x,n.y),e,i)||this.E.push(new vt(t.vv,n.vv))},n.addPoint=function(t,n){var e,i,r,s=this.P.length;this.V.push(new pt(this.V.length,s,0,t));for(var o=0;o<s;++o)if(o!==n){var u=this.P[o],h=(e=t,r=void 0,(r=(i=u).slice(0)).push(i[0]),{rtan:ut(e,r),ltan:ht(e,r)});this.addEdgeIfVisible(t,u[h.ltan],n,o),this.addEdgeIfVisible(t,u[h.rtan],n,o)}return t.vv},n.intersectsPolys=function(t,n,e){for(var i=0,r=this.P.length;i<r;++i)if(i!=n&&i!=e&&yt(t,this.P[i]).length>0)return!0;return!1},t}();function yt(t,n){for(var e=[],i=1,r=n.length;i<r;++i){var s=T.lineIntersection(t.x1,t.y1,t.x2,t.y2,n[i-1].x,n[i-1].y,n[i].x,n[i].y);s&&e.push(s)}return e}function xt(t,n){for(var e=t.length-1,i=n.length-1,r=new lt,s=0;s<=e;++s)for(var o=0;o<=i;++o){var u=t[0==s?e:s-1],h=t[s],a=t[s==e?0:s+1],c=n[0==o?i:o-1],f=n[o],l=n[o==i?0:o+1],d=rt(u,h,f),p=rt(h,c,f),v=rt(h,f,l),g=rt(c,f,h),y=rt(f,u,h),x=rt(f,h,a);d>=0&&p>=0&&v<0&&g>=0&&y>=0&&x<0?r.ll=new ft(s,o):d<=0&&p<=0&&v>0&&g<=0&&y<=0&&x>0?r.rr=new ft(s,o):d<=0&&p>0&&v<=0&&g>=0&&y<0&&x>=0?r.rl=new ft(s,o):d>=0&&p<0&&v>=0&&g<=0&&y>0&&x<=0&&(r.lr=new ft(s,o))}return r}function mt(t,n){return!t.every((function(t){return!function(t,n){for(var e=1,i=n.length;e<i;++e)if(ot(n[e-1],n[e],t))return!1;return!0}(t,n)}))}var _t,bt=(1+Math.sqrt(5))/2;function wt(t,n,e,i,r,s){return void 0===r&&(r=1),void 0===s&&(s=!0),function(i,r){var o=n,u=e,h=(r=void 0!==r?r:1,i=void 0!==i?i:0,0),a=0,c=0,f=0,l=[];function d(t,n){l=[],h=0,a=0,f=0;for(var e=0;e<t.length;e++)p(t[e],n);return Math.abs(h/a-r)}function p(t,n){for(var e=void 0,i=0;i<l.length;i++)if(l[i].space_left>=t.height&&l[i].x+l[i].width+t.width+10-n<=1e-4){e=l[i];break}l.push(t),void 0!==e?(t.x=e.x+e.width+10,t.y=e.bottom,t.space_left=t.height,t.bottom=t.y,e.space_left-=t.height+10,e.bottom+=t.height+10):(t.y=f,f+=t.height+10,t.x=0,t.bottom=t.y,t.space_left=t.height),t.y+t.height-a>-1e-4&&(a=t.y+t.height-0),t.x+t.width-h>-1e-4&&(h=t.x+t.width-0)}0!=t.length&&(function(t){t.forEach((function(t){var n,e,r,s,o;n=t,e=Number.MAX_VALUE,r=Number.MAX_VALUE,s=0,o=0,n.array.forEach((function(t){var n=void 0!==t.width?t.width:i,u=void 0!==t.height?t.height:i;n/=2,u/=2,s=Math.max(t.x+n,s),e=Math.min(t.x-n,e),o=Math.max(t.y+u,o),r=Math.min(t.y-u,r)})),n.width=s-e,n.height=o-r}))}(t),function(t,n){var e=Number.POSITIVE_INFINITY,i=0;t.sort((function(t,n){return n.height-t.height}));for(var r=p=c=t.reduce((function(t,n){return t.width<n.width?t.width:n.width})),s=v=function(t){var n=0;return t.forEach((function(t){return n+=t.width+10})),n}(t),o=0,u=Number.MAX_VALUE,h=Number.MAX_VALUE,a=-1,f=Number.MAX_VALUE,l=Number.MAX_VALUE;f>c||l>1e-4;){if(1!=a){var p=s-(s-r)/bt;u=d(t,p)}if(0!=a){var v=r+(s-r)/bt;h=d(t,v)}if(f=Math.abs(p-v),l=Math.abs(u-h),u<e&&(e=u,i=p),h<e&&(e=h,i=v),u>h?(r=p,p=v,u=h,a=1):(s=v,v=p,h=u,a=0),o++>100)break}d(t,i)}(t),s&&function(t){t.forEach((function(t){var n={x:0,y:0};t.array.forEach((function(t){n.x+=t.x,n.y+=t.y})),n.x/=t.array.length,n.y/=t.array.length;var e=t.x-(n.x-t.width/2)+o/2-h/2,i=t.y-(n.y-t.height/2)+u/2-a/2;t.array.forEach((function(t){t.x+=e,t.y+=i}))}))}(t))}(i,r)}function kt(t,n){for(var e={},i={},r=[],s=0,o=0;o<n.length;o++){var u=n[o],h=u.source,a=u.target;i[h.index]?i[h.index].push(a):i[h.index]=[a],i[a.index]?i[a.index].push(h):i[a.index]=[h]}for(o=0;o<t.length;o++){var c=t[o];e[c.index]||f(c,!0)}function f(t,n){if(void 0===e[t.index]){n&&(s++,r.push({array:[]})),e[t.index]=s,r[s-1].array.push(t);var o=i[t.index];if(o)for(var u=0;u<o.length;u++)f(o[u],!1)}}return r}function Et(t){return void 0!==t.leaves||void 0!==t.groups}(_t=t.EventType||(t.EventType={}))[_t.start=0]="start",_t[_t.tick=1]="tick",_t[_t.end=2]="end";var At=function(){function n(){var t=this;this._canvasSize=[1,1],this._linkDistance=20,this._defaultNodeSize=10,this._linkLengthCalculator=null,this._linkType=null,this._avoidOverlaps=!1,this._handleDisconnected=!0,this._running=!1,this._nodes=[],this._groups=[],this._rootGroup=null,this._links=[],this._constraints=[],this._distanceMatrix=null,this._descent=null,this._directedLinkConstraints=null,this._threshold=.01,this._visibilityGraph=null,this._groupCompactness=1e-6,this.event=null,this.linkAccessor={getSourceIndex:n.getSourceIndex,getTargetIndex:n.getTargetIndex,setLength:n.setLinkLength,getType:function(n){return"function"==typeof t._linkType?t._linkType(n):0}}}var e=n.prototype;return e.on=function(n,e){return this.event||(this.event={}),"string"==typeof n?this.event[t.EventType[n]]=e:this.event[n]=e,this},e.trigger=function(t){this.event&&void 0!==this.event[t.type]&&this.event[t.type](t)},e.kick=function(){for(;!this.tick(););},e.tick=function(){if(this._alpha<this._threshold)return this._running=!1,this.trigger({type:t.EventType.end,alpha:this._alpha=0,stress:this._lastStress}),!0;var n,e,i=this._nodes.length;for(this._descent.locks.clear(),e=0;e<i;++e)(n=this._nodes[e]).fixed&&(void 0!==n.px&&void 0!==n.py||(n.px=n.x,n.py=n.y),this._descent.locks.add(e,[n.px,n.py]));var r=this._descent.rungeKutta();return 0===r?this._alpha=0:void 0!==this._lastStress&&(this._alpha=r),this._lastStress=r,this.updateNodePositions(),this.trigger({type:t.EventType.tick,alpha:this._alpha,stress:this._lastStress}),!1},e.updateNodePositions=function(){for(var t,n=this._descent.x[0],e=this._descent.x[1],i=this._nodes.length;i--;)(t=this._nodes[i]).x=n[i],t.y=e[i]},e.nodes=function(t){if(!t){if(0===this._nodes.length&&this._links.length>0){var n=0;this._links.forEach((function(t){n=Math.max(n,t.source,t.target)})),this._nodes=new Array(++n);for(var e=0;e<n;++e)this._nodes[e]={}}return this._nodes}return this._nodes=t,this},e.groups=function(t){var n=this;return t?(this._groups=t,this._rootGroup={},this._groups.forEach((function(t){void 0===t.padding&&(t.padding=1),void 0!==t.leaves&&t.leaves.forEach((function(e,i){"number"==typeof e&&((t.leaves[i]=n._nodes[e]).parent=t)})),void 0!==t.groups&&t.groups.forEach((function(e,i){"number"==typeof e&&((t.groups[i]=n._groups[e]).parent=t)}))})),this._rootGroup.leaves=this._nodes.filter((function(t){return void 0===t.parent})),this._rootGroup.groups=this._groups.filter((function(t){return void 0===t.parent})),this):this._groups},e.powerGraphGroups=function(t){var n=c(this._nodes,this._links,this.linkAccessor,this._rootGroup);return this.groups(n.groups),t(n),this},e.avoidOverlaps=function(t){return arguments.length?(this._avoidOverlaps=t,this):this._avoidOverlaps},e.handleDisconnected=function(t){return arguments.length?(this._handleDisconnected=t,this):this._handleDisconnected},e.flowLayout=function(t,n){return arguments.length||(t="y"),this._directedLinkConstraints={axis:t,getMinSeparation:"number"==typeof n?function(){return n}:n},this},e.links=function(t){return arguments.length?(this._links=t,this):this._links},e.constraints=function(t){return arguments.length?(this._constraints=t,this):this._constraints},e.distanceMatrix=function(t){return arguments.length?(this._distanceMatrix=t,this):this._distanceMatrix},e.size=function(t){return t?(this._canvasSize=t,this):this._canvasSize},e.defaultNodeSize=function(t){return t?(this._defaultNodeSize=t,this):this._defaultNodeSize},e.groupCompactness=function(t){return t?(this._groupCompactness=t,this):this._groupCompactness},e.linkDistance=function(t){return t?(this._linkDistance="function"==typeof t?t:+t,this._linkLengthCalculator=null,this):this._linkDistance},e.linkType=function(t){return this._linkType=t,this},e.convergenceThreshold=function(t){return t?(this._threshold="function"==typeof t?t:+t,this):this._threshold},e.alpha=function(n){return arguments.length?(n=+n,this._alpha?this._alpha=n>0?n:0:n>0&&(this._running||(this._running=!0,this.trigger({type:t.EventType.start,alpha:this._alpha=n}),this.kick())),this):this._alpha},e.getLinkLength=function(t){return"function"==typeof this._linkDistance?+this._linkDistance(t):this._linkDistance},n.setLinkLength=function(t,n){t.length=n},e.getLinkType=function(t){return"function"==typeof this._linkType?this._linkType(t):0},e.symmetricDiffLinkLengths=function(t,n){var e=this;return void 0===n&&(n=1),this.linkDistance((function(n){return t*n.length})),this._linkLengthCalculator=function(){return p(e._links,e.linkAccessor,n)},this},e.jaccardLinkLengths=function(t,n){var e=this;return void 0===n&&(n=1),this.linkDistance((function(n){return t*n.length})),this._linkLengthCalculator=function(){return v(e._links,e.linkAccessor,n)},this},e.start=function(t,e,i,r,s,o){var u=this;void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=!0),void 0===o&&(o=!0);var h,a=this.nodes().length,c=a+2*this._groups.length,f=this._canvasSize[0],l=this._canvasSize[1],d=new Array(c),p=new Array(c),v=null,y=this._avoidOverlaps;this._nodes.forEach((function(t,n){t.index=n,void 0===t.x&&(t.x=f/2,t.y=l/2),d[n]=t.x,p[n]=t.y})),this._linkLengthCalculator&&this._linkLengthCalculator(),this._distanceMatrix?h=this._distanceMatrix:(h=new tt(c,this._links,n.getSourceIndex,n.getTargetIndex,(function(t){return u.getLinkLength(t)})).DistanceMatrix(),v=m.createSquareMatrix(c,(function(){return 2})),this._links.forEach((function(t){"number"==typeof t.source&&(t.source=u._nodes[t.source]),"number"==typeof t.target&&(t.target=u._nodes[t.target])})),this._links.forEach((function(t){var e=n.getSourceIndex(t),i=n.getTargetIndex(t);v[e][i]=v[i][e]=t.weight||1})));var x=m.createSquareMatrix(c,(function(t,n){return h[t][n]}));if(this._rootGroup&&void 0!==this._rootGroup.groups){var _=a;this._groups.forEach((function(t){!function(t,n,e,i){v[t][n]=v[n][t]=e,x[t][n]=x[n][t]=.1}(_,_+1,u._groupCompactness),void 0===t.bounds?(d[_]=f/2,p[_++]=l/2,d[_]=f/2,p[_++]=l/2):(d[_]=t.bounds.x,p[_++]=t.bounds.y,d[_]=t.bounds.X,p[_++]=t.bounds.Y)}))}else this._rootGroup={leaves:this._nodes,groups:[]};var b=this._constraints||[];for(this._directedLinkConstraints&&(this.linkAccessor.getMinSeparation=this._directedLinkConstraints.getMinSeparation,b=b.concat(g(a,this._links,this._directedLinkConstraints.axis,this.linkAccessor))),this.avoidOverlaps(!1),this._descent=new m([d,p],x),this._descent.locks.clear(),_=0;_<a;++_){var w=this._nodes[_];w.fixed&&(w.px=w.x,w.py=w.y,this._descent.locks.add(_,[w.x,w.y]))}if(this._descent.threshold=this._threshold,this.initialLayout(t,d,p),b.length>0&&(this._descent.project=new K(this._nodes,this._groups,this._rootGroup,b).projectFunctions()),this._descent.run(e),this.separateOverlappingComponents(f,l,o),this.avoidOverlaps(y),y&&(this._nodes.forEach((function(t,n){t.x=d[n],t.y=p[n]})),this._descent.project=new K(this._nodes,this._groups,this._rootGroup,b,!0).projectFunctions(),this._nodes.forEach((function(t,n){d[n]=t.x,p[n]=t.y}))),this._descent.G=v,this._descent.run(i),r){this._descent.snapStrength=1e3,this._descent.snapGridSize=this._nodes[0].width,this._descent.numGridSnapNodes=a,this._descent.scaleSnapByMaxH=a!=c;var k=m.createSquareMatrix(c,(function(t,n){return t>=a||n>=a?v[t][n]:0}));this._descent.G=k,this._descent.run(r)}return this.updateNodePositions(),this.separateOverlappingComponents(f,l,o),s?this.resume():this},e.initialLayout=function(t,e,i){if(this._groups.length>0&&t>0){var r=this._nodes.length,s=this._links.map((function(t){return{source:t.source.index,target:t.target.index}})),o=this._nodes.map((function(t){return{index:t.index}}));this._groups.forEach((function(t,n){o.push({index:t.index=r+n})})),this._groups.forEach((function(t,n){void 0!==t.leaves&&t.leaves.forEach((function(n){return s.push({source:t.index,target:n.index})})),void 0!==t.groups&&t.groups.forEach((function(n){return s.push({source:t.index,target:n.index})}))})),(new n).size(this.size()).nodes(o).links(s).avoidOverlaps(!1).linkDistance(this.linkDistance()).symmetricDiffLinkLengths(5).convergenceThreshold(1e-4).start(t,0,0,0,!1),this._nodes.forEach((function(t){e[t.index]=o[t.index].x,i[t.index]=o[t.index].y}))}else this._descent.run(t)},e.separateOverlappingComponents=function(t,n,e){var i=this;if(void 0===e&&(e=!0),!this._distanceMatrix&&this._handleDisconnected){var r=this._descent.x[0],s=this._descent.x[1];this._nodes.forEach((function(t,n){t.x=r[n],t.y=s[n]})),wt(kt(this._nodes,this._links),t,n,this._defaultNodeSize,1,e),this._nodes.forEach((function(t,n){i._descent.x[0][n]=t.x,i._descent.x[1][n]=t.y,t.bounds&&(t.bounds.setXCentre(t.x),t.bounds.setYCentre(t.y))}))}},e.resume=function(){return this.alpha(.1)},e.stop=function(){return this.alpha(0)},e.prepareEdgeRouting=function(t){void 0===t&&(t=0),this._visibilityGraph=new gt(this._nodes.map((function(n){return n.bounds.inflate(-t).vertices()})))},e.routeEdge=function(t,n,e){void 0===n&&(n=5);var i=[],r=new gt(this._visibilityGraph.P,{V:this._visibilityGraph.V,E:this._visibilityGraph.E}),s={x:t.source.x,y:t.source.y},o={x:t.target.x,y:t.target.y},u=r.addPoint(s,t.source.index),h=r.addPoint(o,t.target.index);r.addEdgeIfVisible(s,o,t.source.index,t.target.index),void 0!==e&&e(r);var a=new tt(r.V.length,r.E,(function(t){return t.source.id}),(function(t){return t.target.id}),(function(t){return t.length()})).PathFromNodeToNode(u.id,h.id);if(1===a.length||a.length===r.V.length){var c=C(t.source.innerBounds,t.target.innerBounds,n);i=[c.sourceIntersection,c.arrowStart]}else{for(var f=a.length-2,l=r.V[a[f]].p,d=r.V[a[0]].p,p=(i=[t.source.innerBounds.rayIntersection(l.x,l.y)],f);p>=0;--p)i.push(r.V[a[p]].p);i.push(O(d,t.target.innerBounds,n))}return i},n.getSourceIndex=function(t){return"number"==typeof t.source?t.source:t.source.index},n.getTargetIndex=function(t){return"number"==typeof t.target?t.target:t.target.index},n.linkId=function(t){return n.getSourceIndex(t)+"-"+n.getTargetIndex(t)},n.dragStart=function(t){Et(t)?n.storeOffset(t,n.dragOrigin(t)):(n.stopNode(t),t.fixed|=2)},n.stopNode=function(t){t.px=t.x,t.py=t.y},n.storeOffset=function(t,e){void 0!==t.leaves&&t.leaves.forEach((function(t){t.fixed|=2,n.stopNode(t),t._dragGroupOffsetX=t.x-e.x,t._dragGroupOffsetY=t.y-e.y})),void 0!==t.groups&&t.groups.forEach((function(t){return n.storeOffset(t,e)}))},n.dragOrigin=function(t){return Et(t)?{x:t.bounds.cx(),y:t.bounds.cy()}:t},n.drag=function(t,e){Et(t)?(void 0!==t.leaves&&t.leaves.forEach((function(n){t.bounds.setXCentre(e.x),t.bounds.setYCentre(e.y),n.px=n._dragGroupOffsetX+e.x,n.py=n._dragGroupOffsetY+e.y})),void 0!==t.groups&&t.groups.forEach((function(t){return n.drag(t,e)}))):(t.px=e.x,t.py=e.y)},n.dragEnd=function(t){Et(t)?(void 0!==t.leaves&&t.leaves.forEach((function(t){n.dragEnd(t),delete t._dragGroupOffsetX,delete t._dragGroupOffsetY})),void 0!==t.groups&&t.groups.forEach(n.dragEnd)):t.fixed&=-7},n.mouseOver=function(t){t.fixed|=4,t.px=t.x,t.py=t.y},n.mouseOut=function(t){t.fixed&=-5},n}(),Mt=function(t){function i(n){e(i=t.call(this)||this);var i,r=n;return r.trigger&&(i.trigger=r.trigger),r.kick&&(i.kick=r.kick),r.drag&&(i.drag=r.drag),r.on&&(i.on=r.on),i.dragstart=i.dragStart=At.dragStart,i.dragend=i.dragEnd=At.dragEnd,i}n(i,t);var r=i.prototype;return r.trigger=function(t){},r.kick=function(){},r.drag=function(){},r.on=function(t,n){return this},i}(At),St=function(i){function r(n){var r;void 0===n&&(n=self.d3),(r=i.call(this)||this).d3Context=n,r.event=n.dispatch(t.EventType[t.EventType.start],t.EventType[t.EventType.tick],t.EventType[t.EventType.end]);var s=e(r);return r.drag=function(){if(!t)var t=n.behavior.drag().origin(At.dragOrigin).on("dragstart.d3adaptor",At.dragStart).on("drag.d3adaptor",(function(t){At.drag(t,s.d3Context.event),s.resume()})).on("dragend.d3adaptor",At.dragEnd);if(!arguments.length)return t;this.call(t)},r}n(r,i);var s=r.prototype;return s.trigger=function(n){var e={type:t.EventType[n.type],alpha:n.alpha,stress:n.stress};this.event[e.type](e)},s.kick=function(){var t=this;this.d3Context.timer((function(){return i.prototype.tick.call(t)}))},s.on=function(n,e){return this.event.on("string"==typeof n?n:t.EventType[n],e),this},r}(At),Pt=function(i){function r(n){var r;(r=i.call(this)||this).d3Context=n,r.event=n.dispatch(t.EventType[t.EventType.start],t.EventType[t.EventType.tick],t.EventType[t.EventType.end]);var s=e(r);return r.drag=function(){if(!t)var t=n.drag().subject(At.dragOrigin).on("start.d3adaptor",At.dragStart).on("drag.d3adaptor",(function(t){At.drag(t,n.event),s.resume()})).on("end.d3adaptor",At.dragEnd);if(!arguments.length)return t;arguments[0].call(t)},r}n(r,i);var s=r.prototype;return s.trigger=function(n){var e={type:t.EventType[n.type],alpha:n.alpha,stress:n.stress};this.event.call(e.type,e)},s.kick=function(){var t=this,n=this.d3Context.timer((function(){return i.prototype.tick.call(t)&&n.stop()}))},s.on=function(n,e){return this.event.on("string"==typeof n?n:t.EventType[n],e),this},r}(At),Lt=function(t,n,e){this.id=t,this.rect=n,this.children=e,this.leaf=void 0===e||0===e.length},Nt=function(t,n,e,i,r){void 0===i&&(i=null),void 0===r&&(r=null),this.id=t,this.x=n,this.y=e,this.node=i,this.line=r},It=function(){function t(n,e){this.s=n,this.t=e;var i=t.findMatch(n,e),r=e.slice(0).reverse(),s=t.findMatch(n,r);i.length>=s.length?(this.length=i.length,this.si=i.si,this.ti=i.ti,this.reversed=!1):(this.length=s.length,this.si=s.si,this.ti=e.length-s.ti-s.length,this.reversed=!0)}return t.findMatch=function(t,n){for(var e=t.length,i=n.length,r={length:0,si:-1,ti:-1},s=new Array(e),o=0;o<e;o++){s[o]=new Array(i);for(var u=0;u<i;u++)if(t[o]===n[u]){var h=s[o][u]=0===o||0===u?1:s[o-1][u-1]+1;h>r.length&&(r.length=h,r.si=o-h+1,r.ti=u-h+1)}else s[o][u]=0}return r},t.prototype.getSequence=function(){return this.length>=0?this.s.slice(this.si,this.si+this.length):[]},t}(),Tt=function(){function t(t,n,e){var i=this;void 0===e&&(e=12),this.originalnodes=t,this.groupPadding=e,this.leaves=null,this.nodes=t.map((function(t,e){return new Lt(e,n.getBounds(t),n.getChildren(t))})),this.leaves=this.nodes.filter((function(t){return t.leaf})),this.groups=this.nodes.filter((function(t){return!t.leaf})),this.cols=this.getGridLines("x"),this.rows=this.getGridLines("y"),this.groups.forEach((function(t){return t.children.forEach((function(n){return i.nodes[n].parent=t}))})),this.root={children:[]},this.nodes.forEach((function(t){void 0===t.parent&&(t.parent=i.root,i.root.children.push(t.id)),t.ports=[]})),this.backToFront=this.nodes.slice(0),this.backToFront.sort((function(t,n){return i.getDepth(t)-i.getDepth(n)})),this.backToFront.slice(0).reverse().filter((function(t){return!t.leaf})).forEach((function(t){var n=T.empty();t.children.forEach((function(t){return n=n.union(i.nodes[t].rect)})),t.rect=n.inflate(i.groupPadding)}));var r=this.midPoints(this.cols.map((function(t){return t.pos}))),s=this.midPoints(this.rows.map((function(t){return t.pos}))),o=r[0],u=r[r.length-1],h=s[0],a=s[s.length-1],c=this.rows.map((function(t){return{x1:o,x2:u,y1:t.pos,y2:t.pos}})).concat(s.map((function(t){return{x1:o,x2:u,y1:t,y2:t}}))),f=this.cols.map((function(t){return{x1:t.pos,x2:t.pos,y1:h,y2:a}})).concat(r.map((function(t){return{x1:t,x2:t,y1:h,y2:a}}))),l=c.concat(f);l.forEach((function(t){return t.verts=[]})),this.verts=[],this.edges=[],c.forEach((function(t){return f.forEach((function(n){var e=new Nt(i.verts.length,n.x1,t.y1);t.verts.push(e),n.verts.push(e),i.verts.push(e);for(var r=i.backToFront.length;r-- >0;){var s=i.backToFront[r],o=s.rect,u=Math.abs(e.x-o.cx()),h=Math.abs(e.y-o.cy());if(u<o.width()/2&&h<o.height()/2){e.node=s;break}}}))})),l.forEach((function(t,n){i.nodes.forEach((function(n,e){n.rect.lineIntersections(t.x1,t.y1,t.x2,t.y2).forEach((function(e,r){var s=new Nt(i.verts.length,e.x,e.y,n,t);i.verts.push(s),t.verts.push(s),n.ports.push(s)}))}));var e=Math.abs(t.y1-t.y2)<.1,r=function(t,n){return e?n.x-t.x:n.y-t.y};t.verts.sort(r);for(var s=1;s<t.verts.length;s++){var o=t.verts[s-1],u=t.verts[s];o.node&&o.node===u.node&&o.node.leaf||i.edges.push({source:o.id,target:u.id,length:Math.abs(r(o,u))})}}))}var n=t.prototype;return n.avg=function(t){return t.reduce((function(t,n){return t+n}))/t.length},n.getGridLines=function(t){for(var n=[],e=this.leaves.slice(0,this.leaves.length);e.length>0;){var i=e.filter((function(n){return n.rect["overlap"+t.toUpperCase()](e[0].rect)})),r={nodes:i,pos:this.avg(i.map((function(n){return n.rect["c"+t]()})))};n.push(r),r.nodes.forEach((function(t){return e.splice(e.indexOf(t),1)}))}return n.sort((function(t,n){return t.pos-n.pos})),n},n.getDepth=function(t){for(var n=0;t.parent!==this.root;)n++,t=t.parent;return n},n.midPoints=function(t){if(1===t.length)return[t[0]];for(var n=t[1]-t[0],e=[t[0]-n/2],i=1;i<t.length;i++)e.push((t[i]+t[i-1])/2);return e.push(t[t.length-1]+n/2),e},n.findLineage=function(t){var n=[t];do{n.push(t=t.parent)}while(t!==this.root);return n.reverse()},n.findAncestorPathBetween=function(t,n){for(var e=this.findLineage(t),i=this.findLineage(n),r=0;e[r]===i[r];)r++;return{commonAncestor:e[r-1],lineages:e.slice(r).concat(i.slice(r))}},n.siblingObstacles=function(t,n){var e=this,i=this.findAncestorPathBetween(t,n),r={};i.lineages.forEach((function(t){return r[t.id]={}}));var s=i.commonAncestor.children.filter((function(t){return!(t in r)}));return i.lineages.filter((function(t){return t.parent!==i.commonAncestor})).forEach((function(t){return s=s.concat(t.parent.children.filter((function(n){return n!==t.id})))})),s.map((function(t){return e.nodes[t]}))},t.getSegmentSets=function(t,n,e){for(var i=[],r=0;r<t.length;r++)for(var s=t[r],o=0;o<s.length;o++)(c=s[o]).edgeid=r,c.i=o,Math.abs(c[1][n]-c[0][n])<.1&&i.push(c);i.sort((function(t,e){return t[0][n]-e[0][n]}));for(var u=[],h=null,a=0;a<i.length;a++){var c=i[a];(!h||Math.abs(c[0][n]-h.pos)>.1)&&u.push(h={pos:c[0][n],segments:[]}),h.segments.push(c)}return u},t.nudgeSegs=function(t,n,e,i,r,s){var o=i.length;if(!(o<=1)){for(var u=i.map((function(n){return new k(n[0][t])})),h=[],a=0;a<o;a++)for(var c=0;c<o;c++)if(a!==c){var f=i[a],l=f.edgeid,d=i[c].edgeid,p=-1,v=-1;"x"==t?r(l,d)&&(f[0][n]<f[1][n]?(p=c,v=a):(p=a,v=c)):r(l,d)&&(f[0][n]<f[1][n]?(p=a,v=c):(p=c,v=a)),p>=0&&h.push(new w(u[p],u[v],s))}new M(u,h).solve(),u.forEach((function(n,r){var s=i[r],o=n.position();s[0][t]=s[1][t]=o;var u=e[s.edgeid];s.i>0&&(u[s.i-1][1][t]=o),s.i<u.length-1&&(u[s.i+1][0][t]=o)}))}},t.nudgeSegments=function(n,e,i,r,s){for(var o=t.getSegmentSets(n,e,i),u=0;u<o.length;u++){for(var h=o[u],a=[],c=0;c<h.segments.length;c++){var f=h.segments[c];a.push({type:0,s:f,pos:Math.min(f[0][i],f[1][i])}),a.push({type:1,s:f,pos:Math.max(f[0][i],f[1][i])})}a.sort((function(t,n){return t.pos-n.pos+t.type-n.type}));var l=[],d=0;a.forEach((function(o){0===o.type?(l.push(o.s),d++):d--,0==d&&(t.nudgeSegs(e,i,n,l,r,s),l=[])}))}},n.routeEdges=function(n,e,i,r){var s=this,o=n.map((function(t){return s.route(i(t),r(t))})),u=t.orderEdges(o),h=o.map((function(n){return t.makeSegments(n)}));return t.nudgeSegments(h,"x","y",u,e),t.nudgeSegments(h,"y","x",u,e),t.unreverseEdges(h,o),h},t.unreverseEdges=function(t,n){t.forEach((function(t,e){n[e].reversed&&(t.reverse(),t.forEach((function(t){t.reverse()})))}))},t.angleBetween2Lines=function(t,n){var e=Math.atan2(t[0].y-t[1].y,t[0].x-t[1].x),i=Math.atan2(n[0].y-n[1].y,n[0].x-n[1].x),r=e-i;return(r>Math.PI||r<-Math.PI)&&(r=i-e),r},t.isLeft=function(t,n,e){return(n.x-t.x)*(e.y-t.y)-(n.y-t.y)*(e.x-t.x)<=0},t.getOrder=function(t){for(var n={},e=0;e<t.length;e++){var i=t[e];void 0===n[i.l]&&(n[i.l]={}),n[i.l][i.r]=!0}return function(t,e){return void 0!==n[t]&&n[t][e]}},t.orderEdges=function(n){for(var e=[],i=0;i<n.length-1;i++)for(var r=i+1;r<n.length;r++){var s,o,u,h=n[i],a=n[r],c=new It(h,a);0!==c.length&&(c.reversed&&(a.reverse(),a.reversed=!0,c=new It(h,a)),(c.si<=0||c.ti<=0)&&(c.si+c.length>=h.length||c.ti+c.length>=a.length)?e.push({l:i,r:r}):(c.si+c.length>=h.length||c.ti+c.length>=a.length?(s=h[c.si+1],u=h[c.si-1],o=a[c.ti-1]):(s=h[c.si+c.length-2],o=h[c.si+c.length],u=a[c.ti+c.length]),t.isLeft(s,o,u)?e.push({l:r,r:i}):e.push({l:i,r:r})))}return t.getOrder(e)},t.makeSegments=function(t){function n(t){return{x:t.x,y:t.y}}for(var e=function(t,n,e){return Math.abs((n.x-t.x)*(e.y-t.y)-(n.y-t.y)*(e.x-t.x))<.001},i=[],r=n(t[0]),s=1;s<t.length;s++){var o=n(t[s]),u=s<t.length-1?t[s+1]:null;u&&e(r,o,u)||(i.push([r,o]),r=o)}return i},n.route=function(t,n){var e=this,i=this.nodes[t],r=this.nodes[n];this.obstacles=this.siblingObstacles(i,r);var s={};this.obstacles.forEach((function(t){return s[t.id]=t})),this.passableEdges=this.edges.filter((function(t){var n=e.verts[t.source],i=e.verts[t.target];return!(n.node&&n.node.id in s||i.node&&i.node.id in s)}));for(var o=1;o<i.ports.length;o++)this.passableEdges.push({source:i.ports[0].id,target:i.ports[o].id,length:0});for(o=1;o<r.ports.length;o++)this.passableEdges.push({source:r.ports[0].id,target:r.ports[o].id,length:0});var u=new tt(this.verts.length,this.passableEdges,(function(t){return t.source}),(function(t){return t.target}),(function(t){return t.length})).PathFromNodeToNodeWithPrevCost(i.ports[0].id,r.ports[0].id,(function(t,n,s){var o=e.verts[t],u=e.verts[n],h=e.verts[s],a=Math.abs(h.x-o.x),c=Math.abs(h.y-o.y);return o.node===i&&o.node===u.node||u.node===r&&u.node===h.node?0:a>1&&c>1?1e3:0})).reverse().map((function(t){return e.verts[t]}));return u.push(this.nodes[r.id].ports[0]),u.filter((function(t,n){return!(n<u.length-1&&u[n+1].node===i&&t.node===i||n>0&&t.node===r&&u[n-1].node===r)}))},t.getRoutePath=function(n,e,i,r){var s,o,u,h,a,c={routepath:"M "+n[0][0].x+" "+n[0][0].y+" ",arrowpath:""};if(n.length>1)for(var f=0;f<n.length;f++){var l=(o=(s=n[f])[1].x)-s[0].x,d=(u=s[1].y)-s[0].y;if(f<n.length-1){Math.abs(l)>0?o-=l/Math.abs(l)*e:u-=d/Math.abs(d)*e,c.routepath+="L "+o+" "+u+" ";var p=n[f+1],v=p[0].x,g=p[0].y;l=p[1].x-v,d=p[1].y-g;var y,x,m=t.angleBetween2Lines(s,p)<0?1:0;Math.abs(l)>0?(y=v+l/Math.abs(l)*e,x=g):(y=v,x=g+d/Math.abs(d)*e);var _=Math.abs(y-o),b=Math.abs(x-u);c.routepath+="A "+_+" "+b+" 0 0 "+m+" "+y+" "+x+" "}else{var w=[o,u];Math.abs(l)>0?(h=[o-=l/Math.abs(l)*r,u+i],a=[o,u-i]):(h=[o+i,u-=d/Math.abs(d)*r],a=[o-i,u]),c.routepath+="L "+o+" "+u+" ",r>0&&(c.arrowpath="M "+w[0]+" "+w[1]+" L "+h[0]+" "+h[1]+" L "+a[0]+" "+a[1])}}else l=(o=(s=n[0])[1].x)-s[0].x,d=(u=s[1].y)-s[0].y,w=[o,u],Math.abs(l)>0?(h=[o-=l/Math.abs(l)*r,u+i],a=[o,u-i]):(h=[o+i,u-=d/Math.abs(d)*r],a=[o-i,u]),c.routepath+="L "+o+" "+u+" ",r>0&&(c.arrowpath="M "+w[0]+" "+w[1]+" L "+h[0]+" "+h[1]+" L "+a[0]+" "+a[1]);return c},t}(),Ct=function(){function t(t,n){this.source=t,this.target=n}return t.prototype.actualLength=function(t){var n=this;return Math.sqrt(t.reduce((function(t,e){var i=e[n.target]-e[n.source];return t+i*i}),0))},t}(),Ot=function(){var t=function(){function t(n,e,i){var s=this;void 0===i&&(i=1),this.nodes=n,this.links=e,this.idealLinkLength=i,this.constraints=null,this.useJaccardLinkLengths=!0,this.result=new Array(t.k);for(var o=0;o<t.k;++o)this.result[o]=new Array(n.length);n.forEach((function(n,e){for(var i,o=r(t.dims);!(i=o()).done;){var u=i.value;void 0===n[u]&&(n[u]=Math.random())}s.result[0][e]=n.x,s.result[1][e]=n.y,s.result[2][e]=n.z}))}var n=t.prototype;return n.linkLength=function(t){return t.actualLength(this.result)},n.start=function(t){var n=this;void 0===t&&(t=100);var e=this.nodes.length,i=new Vt;this.useJaccardLinkLengths&&v(this.links,i,1.5),this.links.forEach((function(t){return t.length*=n.idealLinkLength}));var r=new tt(e,this.links,(function(t){return t.source}),(function(t){return t.target}),(function(t){return t.length})).DistanceMatrix(),s=m.createSquareMatrix(e,(function(t,n){return r[t][n]})),o=m.createSquareMatrix(e,(function(){return 2}));this.links.forEach((function(t){var n=t.source,e=t.target;return o[n][e]=o[e][n]=1})),this.descent=new m(this.result,s),this.descent.threshold=.001,this.descent.G=o,this.constraints&&(this.descent.project=new K(this.nodes,null,null,this.constraints).projectFunctions());for(var u=0;u<this.nodes.length;u++){var h=this.nodes[u];h.fixed&&this.descent.locks.add(u,[h.x,h.y,h.z])}return this.descent.run(t),this},n.tick=function(){this.descent.locks.clear();for(var t=0;t<this.nodes.length;t++){var n=this.nodes[t];n.fixed&&this.descent.locks.add(t,[n.x,n.y,n.z])}return this.descent.rungeKutta()},t}();return t.dims=["x","y","z"],t.k=t.dims.length,t}(),Vt=function(){function t(){}var n=t.prototype;return n.getSourceIndex=function(t){return t.source},n.getTargetIndex=function(t){return t.target},n.getLength=function(t){return t.length},n.setLength=function(t,n){t.length=n},t}();t.BiTangent=ft,t.BiTangents=lt,t.Block=E,t.Blocks=A,t.Calculator=tt,t.Configuration=o,t.Constraint=w,t.ConvexHull=function(t){var n,e=t.slice(0).sort((function(t,n){return t.x!==n.x?n.x-t.x:n.y-t.y})),i=t.length,r=e[0].x;for(n=1;n<i&&e[n].x===r;++n);var s=n-1,o=[];if(o.push(e[0]),s===i-1)e[s].y!==e[0].y&&o.push(e[s]);else{var u,h=i-1,a=e[i-1].x;for(n=i-2;n>=0&&e[n].x===a;n--);for(u=n+1,n=s;++n<=u;)if(!(rt(e[0],e[u],e[n])>=0&&n<u)){for(;o.length>1&&!(rt(o[o.length-2],o[o.length-1],e[n])>0);)o.length-=1;0!=n&&o.push(e[n])}h!=u&&o.push(e[h]);var c=o.length;for(n=u;--n>=s;)if(!(rt(e[h],e[s],e[n])>=0&&n>s)){for(;o.length>c&&!(rt(o[o.length-2],o[o.length-1],e[n])>0);)o.length-=1;0!=n&&o.push(e[n])}}return o},t.Descent=m,t.GridRouter=Tt,t.IndexedVariable=U,t.Iterator=P,t.LLtangent_PolyPolyC=function(t,n){return at(t,n,ht,ht,ot,ot)},t.LRtangent_PolyPolyC=function(t,n){var e=ct(n,t);return{t1:e.t2,t2:e.t1}},t.Layout=At,t.Layout3D=Ot,t.LayoutAdaptor=Mt,t.LineSegment=et,t.Link3D=Ct,t.LinkSets=a,t.Locks=x,t.LongestCommonSubsequence=It,t.Module=u,t.ModuleSet=h,t.Node3D=function(t,n,e){void 0===t&&(t=0),void 0===n&&(n=0),void 0===e&&(e=0),this.x=t,this.y=n,this.z=e},t.NodeWrapper=Lt,t.PairingHeap=W,t.Point=nt,t.PolyPoint=it,t.PositionStats=b,t.PowerEdge=s,t.PriorityQueue=Z,t.Projection=K,t.PseudoRandom=_,t.RBTree=N,t.RLtangent_PolyPolyC=ct,t.RRtangent_PolyPolyC=function(t,n){return at(t,n,ut,ut,st,st)},t.Rectangle=T,t.Solver=M,t.TVGPoint=dt,t.TangentVisibilityGraph=gt,t.TreeBase=S,t.Variable=k,t.Vert=Nt,t.VisibilityEdge=vt,t.VisibilityVertex=pt,t.adaptor=function(t){return new Mt(t)},t.applyPacking=wt,t.clockwiseRadialSweep=function(t,n,e){n.slice(0).sort((function(n,e){return Math.atan2(n.y-t.y,n.x-t.x)-Math.atan2(e.y-t.y,e.x-t.x)})).forEach(e)},t.computeGroupBounds=I,t.d3adaptor=function(t){return!t||function(t){return t.version&&null!==t.version.match(/^3\./)}(t)?new St(t):new Pt(t)},t.generateDirectedEdgeConstraints=g,t.generateXConstraints=R,t.generateXGroupConstraints=F,t.generateYConstraints=q,t.generateYGroupConstraints=H,t.getGroups=c,t.gridify=function(t,n,e,i){return t.cola.start(0,0,0,10,!1),function(t,n,e,i){t.forEach((function(t){t.routerNode={name:t.name,bounds:t.bounds.inflate(-e)}})),n.forEach((function(n){n.routerNode={bounds:n.bounds.inflate(-i),children:(void 0!==n.groups?n.groups.map((function(n){return t.length+n.id})):[]).concat(void 0!==n.leaves?n.leaves.map((function(t){return t.index})):[])}}));var r=t.concat(n).map((function(t,n){return t.routerNode.id=n,t.routerNode}));return new Tt(r,{getChildren:function(t){return t.children},getBounds:function(t){return t.bounds}},e-i)}(t.cola.nodes(),t.cola.groups(),e,i).routeEdges(t.powerGraph.powerEdges,n,(function(t){return t.source.routerNode.id}),(function(t){return t.target.routerNode.id}))},t.isLeft=rt,t.jaccardLinkLengths=v,t.makeEdgeBetween=C,t.makeEdgeTo=O,t.polysOverlap=function(t,n){if(mt(t,n))return!0;if(mt(n,t))return!0;for(var e=1,i=t.length;e<i;++e){var r=t[e],s=t[e-1];if(yt(new et(s.x,s.y,r.x,r.y),n).length>0)return!0}return!1},t.powerGraphGridLayout=function(t,n,e){var i;t.nodes.forEach((function(t,n){return t.index=n})),(new At).avoidOverlaps(!1).nodes(t.nodes).links(t.links).powerGraphGroups((function(t){(i=t).groups.forEach((function(t){return t.padding=e}))}));var r=t.nodes.length,s=[],o=t.nodes.slice(0);return o.forEach((function(t,n){return t.index=n})),i.groups.forEach((function(t){var n=t.index=t.id+r;o.push(t),void 0!==t.leaves&&t.leaves.forEach((function(t){return s.push({source:n,target:t.index})})),void 0!==t.groups&&t.groups.forEach((function(t){return s.push({source:n,target:t.id+r})}))})),i.powerEdges.forEach((function(t){s.push({source:t.source.index,target:t.target.index})})),(new At).size(n).nodes(o).links(s).avoidOverlaps(!1).linkDistance(30).symmetricDiffLinkLengths(5).convergenceThreshold(1e-4).start(100,0,0,0,!1),{cola:(new At).convergenceThreshold(.001).size(n).avoidOverlaps(!0).nodes(t.nodes).links(t.links).groupCompactness(1e-4).linkDistance(30).symmetricDiffLinkLengths(5).powerGraphGroups((function(t){(i=t).groups.forEach((function(t){t.padding=e}))})).start(50,0,100,0,!1),powerGraph:i}},t.removeOverlapInOneDimension=function(t,n,e){for(var i=t.map((function(t){return new k(t.desiredCenter)})),r=[],s=t.length,o=0;o<s-1;o++)r.push(new w(i[o],i[o+1],(t[o].size+t[o+1].size)/2));var u=i[0],h=i[s-1],a=t[0].size/2,c=t[s-1].size/2,f=null,l=null;return n&&(f=new k(n,1e3*u.weight),i.push(f),r.push(new w(f,u,a))),e&&(l=new k(e,1e3*h.weight),i.push(l),r.push(new w(h,l,c))),new M(i,r).solve(),{newCenters:i.slice(0,t.length).map((function(t){return t.position()})),lowerBound:f?f.position():u.position()-a,upperBound:l?l.position():h.position()+c}},t.removeOverlaps=function(t){var n=t.map((function(t){return new k(t.cx())})),e=R(t,n),i=new M(n,e);i.solve(),n.forEach((function(n,e){return t[e].setXCentre(n.position())})),n=t.map((function(t){return new k(t.cy())})),e=q(t,n),(i=new M(n,e)).solve(),n.forEach((function(n,e){return t[e].setYCentre(n.position())}))},t.separateGraphs=kt,t.stronglyConnectedComponents=y,t.symmetricDiffLinkLengths=p,t.tangent_PolyPolyC=at,t.tangents=xt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=cola.umd.production.min.js.map
